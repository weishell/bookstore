<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title></title>
	</head>
	<body>
			<input type="file" name="file"  id='ac'/>
			<img id="portrait" src="" width="300" height="300">
	</body>
</html>
<script type="text/javascript">
		let ac = document.getElementById('ac')
		ac.onchange = (e)=>
		{
			var file = e.target.files[0];
			if(window.FileReader) {
				console.log(1)
				
				var fr = new FileReader();
				fr.onload = function(e) {
					const img = document.getElementById("portrait")
					img.src  = e.target.result

					setTimeout(() => {
						const canvas = document.createElement('canvas');  
  					canvas.width = img.width;  
  					canvas.height = img.height;  
  					const ctx = canvas.getContext('2d');  


					ctx.drawImage(img, 0, 0, img.width, img.height); 


					

					// img.src = e.target.result;

					let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);   

					  // 使用TypedArray来操作图像数据  
						const data = imageData.data; // 这是一个Uint8ClampedArray  
						for (let i = 0; i < data.length; i += 4) {  
							// 假设第一个通道为红色  
							data[i] = 255; // R  
							// data[i + 1] = 0; // G  
							// data[i + 2] = 0; // B  
							data[i + 3] = 200; // Alpha通道  
						}  
					// 将修改后的数据放回canvas  
  					ctx.putImageData(imageData, 0, 0);  
  
					// 可选：将canvas内容转换回图像并显示在页面上  
					// 您可以直接使用canvas元素或者将其转换为Blob URL  
					img.src = canvas.toDataURL('image/png'); 
					});
				 
					
					// 如果您需要Blob URL  
					// canvas.toBlob(function(blob) {  
					// 	const itemUrl = URL.createObjectURL(blob);  
					// 	console.log(itemUrl); // 这里打印Blob URL  
					// 	// 您可以使用这个URL做其他事情，比如赋值给另一个img元素的src属性  
					// }, 'image/png');  
				};
				fr.readAsDataURL(file);
			}
		}
	</script>
